<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peminjaman Buku Perpustakaan SMASAMETA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide-react/0.263.1/lucide-react.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(229, 231, 235, 1);
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen pb-12">

    <!-- Header -->
    <header class="bg-blue-600 text-white py-8 mb-8 shadow-lg">
        <div class="container mx-auto px-4">
            <h1 class="text-3xl font-bold flex items-center gap-3">
                <span id="book-icon"></span>
                E-Perpus: Sistem Peminjaman
            </h1>
            <p class="mt-2 opacity-90">WEB PEMINJAMAN BUKU SMAN 1 MAGETAN.</p>
        </div>
    </header>

    <main class="container mx-auto px-4 grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <!-- Left Column: Form & Rules -->
        <div class="lg:col-span-1 space-y-6">
            
            <!-- Tata Tertib Section -->
            <section class="glass-card p-6 rounded-2xl shadow-sm border-l-4 border-amber-500">
                <h2 class="text-xl font-semibold mb-4 flex items-center gap-2 text-amber-700">
                    <span id="info-icon"></span> Tata Tertib
                </h2>
                <ul class="space-y-2 text-sm text-slate-600 list-disc pl-5">
                    <li>Peminjam wajib menjaga keutuhan buku.</li>
                    <li>Maksimal peminjaman adalah 7 hari.</li>
                    <li>Keterlambatan dikenakan denda Rp 1.000/hari.</li>
                    <li>Buku yang hilang wajib diganti dengan judul yang sama.</li>
                </ul>
            </section>

            <!-- Form Peminjaman -->
            <section class="glass-card p-6 rounded-2xl shadow-sm">
                <h2 class="text-xl font-semibold mb-6 text-slate-800">Form Peminjaman</h2>
                <form id="borrowForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Nama Lengkap</label>
                        <input type="text" id="nama" required class="w-full p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Kelas</label>
                            <input type="text" id="kelas" required placeholder="Contoh: 10 IPA 1" class="w-full p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">No. Absen</label>
                            <input type="number" id="absen" required class="w-full p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Judul Buku</label>
                        <input type="text" id="judul" required class="w-full p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Lama Pinjam (Hari)</label>
                        <select id="lama" class="w-full p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                            <option value="3">3 Hari</option>
                            <option value="5">5 Hari</option>
                            <option value="7">7 Hari (Maksimal)</option>
                        </select>
                    </div>

                    <button type="submit" id="submitBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg transition-colors flex justify-center items-center gap-2">
                        Simpan Pinjaman
                    </button>
                </form>
            </section>
        </div>

        <!-- Right Column: Data Table -->
        <div class="lg:col-span-2">
            <div class="glass-card rounded-2xl shadow-sm overflow-hidden">
                <div class="p-6 border-b border-slate-200 flex justify-between items-center bg-white">
                    <h2 class="text-xl font-semibold text-slate-800">Daftar Peminjaman Aktif</h2>
                    <span id="count-badge" class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-sm font-medium">0 Buku</span>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead class="bg-slate-50 text-slate-500 text-sm uppercase">
                            <tr>
                                <th class="px-6 py-4 font-semibold">Siswa</th>
                                <th class="px-6 py-4 font-semibold">Buku</th>
                                <th class="px-6 py-4 font-semibold">Tgl Pinjam</th>
                                <th class="px-6 py-4 font-semibold">Durasi</th>
                                <th class="px-6 py-4 font-semibold text-right">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody" class="divide-y divide-slate-100">
                            <!-- Data will be loaded here -->
                            <tr>
                                <td colspan="5" class="px-6 py-12 text-center text-slate-400">
                                    <p>Memuat data atau belum ada peminjaman...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Custom Toast Notification -->
    <div id="toast" class="fixed bottom-6 right-6 transform translate-y-20 opacity-0 transition-all duration-300 bg-slate-800 text-white px-6 py-3 rounded-xl shadow-2xl flex items-center gap-3">
        <span id="toast-icon"></span>
        <span id="toast-message"></span>
    </div>

    <!-- Firebase Scripts -->
    <script>
	function showToast(message, type = "success") {
  const toast = document.getElementById("toast");
  const msg = document.getElementById("toast-message");

  msg.innerText = message;

  toast.className = `fixed bottom-6 right-6 transform translate-y-0 opacity-100 transition-all duration-300 ${
    type === "success" ? "bg-green-600" : "bg-red-600"
  } text-white px-6 py-3 rounded-xl shadow-2xl`;

  setTimeout(() => {
    toast.className =
      "fixed bottom-6 right-6 transform translate-y-20 opacity-0 transition-all duration-300 bg-slate-800 text-white px-6 py-3 rounded-xl";
  }, 3000);
}

const GAS_URL = "https://script.google.com/macros/s/AKfycbyaHvSv0lZgKyA7jdlua6B9OkBjHW7aamycx0cjnyyml6-81LhD9Ddzgki9TTjql5NqLQ/exec";

const form = document.getElementById("borrowForm");

form.addEventListener("submit", async function(e) {
  e.preventDefault();

  const data = {
    nama: document.getElementById("nama").value,
    kelas: document.getElementById("kelas").value,
    absen: document.getElementById("absen").value,
    judul: document.getElementById("judul").value,
    lama: document.getElementById("lama").value
  };

  try {
    const res = await fetch(GAS_URL, {
      method: "POST",
      body: JSON.stringify(data)
    });

    const result = await res.json();

    if (result.status === "success") {
      showToast("Data berhasil disimpan!");
      form.reset();
    } else {
      showToast("Gagal menyimpan data", "error");
    }

  } catch (err) {
    showToast("Koneksi gagal", "error");
  }
});
</script>

</body>
</html>